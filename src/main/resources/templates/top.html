<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org/">
<head>
    <meta charset="UTF-8">
    <title>ë„ì„œ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
    <div th:fragment="topbar1">
        <nav class="topbar">
            <div>
                <a th:href="@{/book/list}" class="nav-link">ğŸ  í™ˆ</a>
            </div>
            <div class="logo" th:text="'ë„ì„œ ê´€ë¦¬ ì‹œìŠ¤í…œ'">ë„ì„œ ê´€ë¦¬ ì‹œìŠ¤í…œ</div>
            <!--í˜„ì¬ëŠ” ë¡œê·¸ì¸ í•˜ê¸° ì „ th:ifì‚¬ìš©í•˜ì—¬-->
            <!--ë¡œê·¸ì¸ í•œ í›„ í˜„ì¬ ìë¦¬ì— 'ë‚˜ì˜ ëŒ€ì—¬ ê¸°ë¡' ë²„íŠ¼ ë§Œë“¤ê¸°  => ë²„íŠ¼ ëˆ„ë¥´ë©´ ë‚˜ì˜ ëŒ€ì—¬ ê¸°ë¡ í˜ì´ì§€ë¡œ ì´ë™(/rent/list)-->
            <div>
                <div id="auth-section">
                    <!-- ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ê³¼ ì‚¬ìš©ìëª…ì„ ì¶”ê°€í•©ë‹ˆë‹¤. -->
                </div>
        </nav>
    </div>

    <script>
        $(document).ready(function () {
            const token = localStorage.getItem("auth-token");

            if (token) {
                // JWT í† í°ì„ ì‚¬ìš©í•´ ì‚¬ìš©ì ì´ë¦„ ê°€ì ¸ì˜¤ê¸°
                $.ajax({
                    type: "GET",
                    url: "http://127.0.0.1:7070/user/info", // ì‚¬ìš©ì ì •ë³´ë¥¼ ë°˜í™˜í•˜ëŠ” API
                    headers: {
                        "Authorization": token
                    }
                }).done(function (response) {
                    // ì‚¬ìš©ì ì´ë¦„ í‘œì‹œ ë° ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ìƒì„±
                    const username = decodeURIComponent(response.username); // URL ë””ì½”ë”©
                    $("#auth-section").html(`
                        <span>${username}ë‹˜</span>
                        <button id="logout-btn" class="btn logout-btn">ë¡œê·¸ì•„ì›ƒ</button>
                    `);

                    // ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ì´ë²¤íŠ¸
                    $("#logout-btn").click(function () {
                        localStorage.removeItem("auth-token"); // í† í° ì‚­ì œ
                        location.reload(); // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                    });
                }).fail(function () {
                    // í† í°ì´ ìœ íš¨í•˜ì§€ ì•Šì„ ê²½ìš°
                    localStorage.removeItem("auth-token");
                    $("#auth-section").html('<a href="/user/login" class="btn login-btn">ë¡œê·¸ì¸</a>');
                });
            } else {
                // ë¡œê·¸ì•„ì›ƒ ìƒíƒœ: ë¡œê·¸ì¸ ë²„íŠ¼ í‘œì‹œ
                $("#auth-section").html('<a href="/user/login" class="btn login-btn">ë¡œê·¸ì¸</a>');
            }
        });
    </script>
</body>
</html>